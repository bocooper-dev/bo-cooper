import{D as e,E as l,B as a,F as t,P as i,l as n,C as s,H as r,h as u,ar as d,ab as o,T as c}from"./DkcxcMuv.js";import v from"./GDANyMds.js";import{d as p,l as f,R as m,m as g,M as h,N as y,O as b,X as x,u as k,U as K,a6 as A,P as S,v as C,L as I,aa as V,q as T,as as _,A as w,ai as E,H as j,ah as B,ac as L,a7 as $,Y as M,a9 as R}from"./BOuGH_in.js";import{M as P}from"./uAMotQ-B.js";import{f as W,u as q}from"./DVVlQUnk.js";import{_ as O,a as z}from"./BKL9XcTV.js";function F(e){return e.reduce((e,l)=>(e.push(l),l.children&&e.push(...F(l.children)),e),[])}const[H,N]=a("TreeRoot"),D=f({__name:"TreeRoot",props:{modelValue:{},defaultValue:{},items:{},expanded:{},defaultExpanded:{},getKey:{},getChildren:{type:Function,default:e=>e.children},selectionBehavior:{default:"toggle"},multiple:{},dir:{},disabled:{type:Boolean},propagateSelect:{type:Boolean},bubbleSelect:{type:Boolean},asChild:{type:Boolean},as:{default:"ul"}},emits:["update:modelValue","update:expanded"],setup(a,{emit:s}){const r=a,u=s,{items:d,multiple:o,disabled:c,propagateSelect:v,dir:f,bubbleSelect:I}=m(r),{handleTypeaheadSearch:V}=q(),T=e(f),_=p(),w=p(!1),E=t(),j=l(r,"modelValue",u,{defaultValue:r.defaultValue??(o.value?[]:void 0),passive:void 0===r.modelValue,deep:!0}),B=l(r,"expanded",u,{defaultValue:r.defaultExpanded??[],passive:void 0===r.expanded,deep:!0}),{onSelectItem:L,handleMultipleReplace:$}=function(e,l){const a=p();return{firstValue:a,onSelectItem:(t,i)=>{if(l.multiple&&Array.isArray(e.value))if("replace"===l.selectionBehavior)e.value=[t],a.value=t;else{const l=e.value.findIndex(e=>i(e));e.value=-1!==l?e.value.filter((e,a)=>a!==l):[...e.value,t]}else"replace"===l.selectionBehavior?e.value={...t}:!Array.isArray(e.value)&&i(e.value)?e.value=void 0:e.value={...t};return e.value},handleMultipleReplace:function(t,i,n,s){if(!a?.value||!l.multiple||!Array.isArray(e.value))return;const r=n().filter(e=>""!==e.ref.dataset.disabled),u=r.find(e=>e.ref===i)?.value;if(!u)return;let d=null;switch(t){case"prev":case"next":d=W(s,a.value,u);break;case"first":d=W(s,a.value,s?.[0]);break;case"last":d=W(s,a.value,s?.[s.length-1])}e.value=d}}}(j,r),M=g(()=>o.value&&Array.isArray(j.value)?j.value.map(e=>r.getKey(e)):[r.getKey(j.value??{})]);function R(e,l=1,a){return e.reduce((t,i,n)=>{const s=r.getKey(i),u=r.getChildren(i),d=B.value.includes(s),o={_id:s,value:i,index:n,level:l,parentItem:a,hasChildren:!!u,bind:{value:i,level:l,"aria-setsize":e.length,"aria-posinset":n+1}};return t.push(o),u&&d&&t.push(...R(u,l+1,i)),t},[])}const z=g(()=>{const e=r.items;return B.value.map(e=>e),R(e??[])});function H(e){if(w.value)E.trigger(e);else{const l=_.value?.getItems()??[];V(e.key,l)}}function D(e){if(w.value)return;const l=P[e.key];C(()=>{$(l,n(),_.value?.getItems,z.value.map(e=>e.value))})}function U(e){if(null!=e.parentItem&&Array.isArray(j.value)&&r.multiple){const l=z.value.find(l=>null!=e.parentItem&&r.getKey(l.value)===r.getKey(e.parentItem));if(null!=l){const e=r.getChildren(l.value)?.every(e=>j.value.find(l=>r.getKey(l)===r.getKey(e)));j.value=e?[...j.value,l.value]:j.value.filter(e=>r.getKey(e)!==r.getKey(l.value)),U(l)}}}return N({modelValue:j,selectedKeys:M,onSelect:e=>{const l=l=>r.getKey(l??{})===r.getKey(e),a=r.multiple&&Array.isArray(j.value)?-1!==j.value?.findIndex(l):void 0;if(L(e,l),r.bubbleSelect&&r.multiple&&Array.isArray(j.value)){const l=z.value.find(l=>r.getKey(l.value)===r.getKey(e));null!=l&&U(l)}if(r.propagateSelect&&r.multiple&&Array.isArray(j.value)){const l=F(r.getChildren(e)??[]);j.value=a?[...j.value].filter(e=>!l.some(l=>r.getKey(e??{})===r.getKey(l))):[...j.value,...l]}},expanded:B,onToggle(e){if(!(e?r.getChildren(e):void 0))return;const l=r.getKey(e)??e;B.value.includes(l)?B.value=B.value.filter(e=>e!==l):B.value.push(l)},getKey:r.getKey,getChildren:r.getChildren,items:d,expandedItems:z,disabled:c,multiple:o,dir:T,propagateSelect:v,bubbleSelect:I,isVirtual:w,virtualKeydownHook:E,handleMultipleReplace:$}),(e,l)=>(y(),h(k(O),{ref_key:"rovingFocusGroupRef",ref:_,"as-child":"",orientation:"vertical",dir:k(T)},{default:b(()=>[x(k(i),{role:"tree",as:e.as,"as-child":e.asChild,"aria-multiselectable":!!k(o)||void 0,onKeydown:[H,K(A(D,["shift"]),["up","down"])]},{default:b(()=>[S(e.$slots,"default",{flattenItems:z.value,modelValue:k(j),expanded:k(B)})]),_:3},8,["as","as-child","aria-multiselectable","onKeydown"])]),_:3},8,["dir"]))}}),U=f({inheritAttrs:!1,__name:"TreeItem",props:{value:{},level:{},asChild:{type:Boolean},as:{default:"li"}},emits:["select","toggle"],setup(e,{expose:l,emit:a}){const t=e,u=a,d=H(),{getItems:o}=s(),c=g(()=>!!d.getChildren(t.value)),v=g(()=>{const e=d.getKey(t.value);return d.expanded.value.includes(e)}),p=g(()=>{const e=d.getKey(t.value);return d.selectedKeys.value.includes(e)}),f=g(()=>{if(d.bubbleSelect.value&&c.value&&Array.isArray(d.modelValue.value)){const e=F(d.getChildren(t.value)||[]);return e.some(e=>d.modelValue.value.find(l=>d.getKey(l)===d.getKey(e)))&&!e.every(e=>d.modelValue.value.find(l=>d.getKey(l)===d.getKey(e)))}if(d.propagateSelect.value&&p.value&&c.value&&Array.isArray(d.modelValue.value)){return!F(d.getChildren(t.value)||[]).every(e=>d.modelValue.value.find(l=>d.getKey(l)===d.getKey(e)))}});function m(e){if(c.value)if(v.value){const e=o().map(e=>e.ref),l=n(),a=e.indexOf(l),i=[...e].slice(a).find(e=>Number(e.getAttribute("data-indent"))===t.level+1);i&&i.focus()}else w(e)}function C(e){if(v.value)w(e);else{const e=o().map(e=>e.ref),l=n(),a=e.indexOf(l),i=[...e].slice(0,a).reverse().find(e=>Number(e.getAttribute("data-indent"))===t.level-1);i&&i.focus()}}async function V(e){u("select",e),e?.defaultPrevented||d.onSelect(t.value)}async function T(e){u("toggle",e),e?.defaultPrevented||d.onToggle(t.value)}async function _(e){if(!e)return;const l={originalEvent:e,value:t.value,isExpanded:v.value,isSelected:p.value};r("tree.select",V,l)}async function w(e){if(!e)return;const l={originalEvent:e,value:t.value,isExpanded:v.value,isSelected:p.value};r("tree.toggle",T,l)}return l({isExpanded:v,isSelected:p,isIndeterminate:f,handleToggle:()=>d.onToggle(t.value),handleSelect:()=>d.onSelect(t.value)}),(e,l)=>(y(),h(k(z),{"as-child":"",value:e.value,"allow-shift-key":""},{default:b(()=>[x(k(i),I(e.$attrs,{role:"treeitem",as:e.as,"as-child":e.asChild,"aria-selected":p.value,"aria-expanded":c.value?v.value:void 0,"aria-level":e.level,"data-indent":e.level,"data-selected":p.value?"":void 0,"data-expanded":v.value?"":void 0,onKeydown:[K(A(_,["self","prevent"]),["enter","space"]),l[0]||(l[0]=K(A(e=>"ltr"===k(d).dir.value?m(e):C(e),["prevent"]),["right"])),l[1]||(l[1]=K(A(e=>"ltr"===k(d).dir.value?C(e):m(e),["prevent"]),["left"]))],onClick:l[2]||(l[2]=A(e=>{_(e),w(e)},["stop"]))}),{default:b(()=>[S(e.$slots,"default",{isExpanded:v.value,isSelected:p.value,isIndeterminate:f.value,handleSelect:()=>k(d).onSelect(e.value),handleToggle:()=>k(d).onToggle(e.value)})]),_:3},16,["as","as-child","aria-selected","aria-expanded","aria-level","data-indent","data-selected","data-expanded","onKeydown"])]),_:3},8,["value"]))}}),G={slots:{root:"relative lg:h-[450px] my-5 grid lg:grid-cols-3 border border-muted rounded-md",list:"isolate relative p-2 border-b lg:border-b-0 lg:border-e border-muted overflow-y-auto",item:"",listWithChildren:"ms-4.5 border-s border-default",itemWithChildren:"ps-1.5 -ms-px",link:"relative group peer w-full px-2.5 py-1.5 before:inset-y-px before:inset-x-0 flex items-center gap-1.5 text-sm before:absolute before:z-[-1] before:rounded-md focus:outline-none focus-visible:outline-none focus-visible:before:ring-inset focus-visible:before:ring-2",linkLeadingIcon:"size-4 shrink-0",linkLabel:"truncate",linkTrailing:"ms-auto inline-flex gap-1.5 items-center",linkTrailingIcon:"size-5 transform transition-transform duration-200 shrink-0 group-data-expanded:rotate-180",content:"overflow-hidden lg:col-span-2 flex flex-col [&>div]:my-0 [&>div]:flex-1 [&>div]:flex [&>div]:flex-col [&>div>div]:border-0 [&>div>pre]:border-b-0 [&>div>pre]:border-s-0 [&>div>pre]:border-e-0 [&>div>pre]:rounded-l-none [&>div>pre]:flex-1 [&>div]:overflow-y-auto"},variants:{active:{true:{link:"text-highlighted before:bg-elevated"},false:{link:["hover:text-highlighted hover:before:bg-elevated/50","transition-colors before:transition-colors"]}}}},X=Object.assign({inheritAttrs:!1},{__name:"ProseCodeTree",props:{defaultValue:{type:String,required:!1},expandAll:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(e){const l=e,a=V(),t=u(),[i,n]=d(),s=g(()=>o({extend:o(G),...t.uiPro?.prose?.codeTree||{}})()),r=p(l.defaultValue?{path:l.defaultValue}:void 0),f=p(),m=p(1),K=g(()=>(m.value,a.default?.()?.flatMap(S).filter(Boolean)||[])),A=g(()=>function(e){const l=new Map,a=[];e.forEach(e=>{const t=e.label.split("/");let i="";t.forEach((e,n)=>{if(i=i?`${i}/${e}`:e,!l.has(i)){const s={label:e,path:i,...n<t.length-1&&{children:[]}};l.set(i,s),0===n?a.push(s):l.get(t.slice(0,n).join("/"))?.children?.push(s)}})});const t=e=>e.sort((e,l)=>!!e.children==!!l.children?e.label.localeCompare(l.label):l.children?1:-1).map(e=>({...e,children:e.children&&t(e.children)}));return t(a)}(K.value));function S(e,l){return"symbol"==typeof e.type?e.children?.map(S):{label:e.props?.filename||e.props?.label||`${l}`,icon:e.props?.icon,component:e}}const C=g(()=>{if(l.expandAll){const e=new Set;return K.value.forEach(l=>{const a=l.label.split("/");for(let t=1;t<a.length;t++)e.add(a.slice(0,t).join("/"))}),Array.from(e)}const e=r.value?.path;if(!e)return[];const a=e.split("/");return a.map((e,l)=>a.slice(0,l+1).join("/"))});return T(r,e=>{const l=K.value.find(l=>e?.path===l.label);l?.component&&(f.value=l)},{immediate:!0}),_(()=>m.value++),(e,a)=>(y(),w(j,null,[x(k(i),null,{default:b(({items:e,level:a})=>[(y(!0),w(j,null,B(e,(e,i)=>(y(),w("li",{key:`${a}-${i}`,class:L(a>0?s.value.itemWithChildren({class:l.ui?.itemWithChildren}):s.value.item({class:l.ui?.item}))},[x(k(U),{"as-child":"",level:a,value:e},{default:b(({isExpanded:i,isSelected:r})=>[E("button",{class:L(s.value.link({class:l.ui?.link,active:r}))},[e.children?.length?(y(),h(c,{key:0,name:i?k(t).ui.icons.folderOpen:k(t).ui.icons.folder,class:L(s.value.linkLeadingIcon({class:l.ui?.linkLeadingIcon}))},null,8,["name","class"])):(y(),h(v,{key:1,filename:e.label,class:L(s.value.linkLeadingIcon({class:l.ui?.linkLeadingIcon}))},null,8,["filename","class"])),E("span",{class:L(s.value.linkLabel({class:l.ui?.linkLabel}))},R(e.label),3),e.children?.length?(y(),w("span",{key:2,class:L(s.value.linkTrailing({class:l.ui?.linkTrailing}))},[x(c,{name:k(t).ui.icons.chevronDown,class:L(s.value.linkTrailingIcon({class:l.ui?.linkTrailingIcon}))},null,8,["name","class"])],2)):M("",!0)],2),e.children?.length&&i?(y(),w("ul",{key:0,class:L(s.value.listWithChildren({class:l.ui?.listWithChildren}))},[x(k(n),{items:e.children,level:a+1},null,8,["items","level"])],2)):M("",!0)]),_:2},1032,["level","value"])],2))),128))]),_:1}),E("div",I(e.$attrs,{class:s.value.root({class:[l.ui?.root,l.class]})}),[x(k(D),{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e),class:L(s.value.list({class:l.ui?.list})),items:A.value,"get-key":e=>e.path,"default-expanded":C.value},{default:b(()=>[x(k(n),{items:A.value,level:0},null,8,["items"])]),_:1},8,["modelValue","class","items","get-key","default-expanded"]),E("div",{class:L(s.value.content({class:l.ui?.content}))},[(y(),h($(f.value?.component)))],2)],16)],64))}});export{X as default};
